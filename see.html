<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë´‰ìš°ë¦¬ ì¶œì²µ</title>

  <link rel="icon" type="image/png" href="./images/Screenshot_20251118_085515_KakaoTalk-Photoroom.png">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

  <link rel="stylesheet" href="./styles/index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&family=Oswald:wght@200..700&family=Smooch+Sans:wght@100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&family=Stack+Sans+Notch:wght@200..700&display=swap" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js"></script>

  <!-- Firebase (module) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD1KyOhE1NlQtRIzSHIiab7KIKF2L-mc34",
      authDomain: "board-game-72c4e.firebaseapp.com",
      databaseURL: "https://board-game-72c4e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "board-game-72c4e",
      storageBucket: "board-game-72c4e.firebasestorage.app",
      messagingSenderId: "761901243936",
      appId: "1:761901243936:web:4875105f24a1b35e122645",
      measurementId: "G-DG0J9K8VQV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    window._fb = { db, ref, get }; // ì „ì—­ìœ¼ë¡œ ê°„ë‹¨íˆ ì ‘ê·¼
  </script>
</head>

<body>
    <!-- í—¤ë” -->
    <header>
      <div>
        <!-- <a href="/board-game/index.html"> -->
          <a href="./index.html">
          <img 
            src="./images/Screenshot_20251118_085515_KakaoTalk-Photoroom.png" 
            alt="ë´‰ìš°ë¦¬ ë¡œê³ "
          >
        </a>
      </div>
    </header>

    <!-- ë©”ë‰´ í† ê¸€ ë²„íŠ¼ -->
    <button class="menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°">ğŸ”</button>

    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <nav class="side-menu" aria-hidden="true">
      <div class="side-menu__header">
        <button class="side-menu__close" aria-label="ë©”ë‰´ ë‹«ê¸°">âŒ</button>
      </div>
      
      <div class="side-menu__body">
        <ul>
          <li>
            <!-- <a href="/board-game/see.html"> -->
              <a href="./see.html">
              ğŸ‘€ ì›”ë³„ë¡œ ì¶œì„ì²´í¬ í•œëˆˆì— ë³´ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/money.html"> -->
              <a href="./money.html">
              ğŸ’¸ ì¼ì°¸ë¹„/ì›”ì •ì•¡ ì…ê¸ˆí•˜ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/place.html"> -->
            <a href="./place.html">
              ğŸ¯ ë´‰ìš°ë¦¬ ì•„ì§€íŠ¸ ìœ„ì¹˜ë³´ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/parking.html"> -->
            <a href="./parking.html">
              ğŸš˜ ì£¼ì°¨ ê°€ëŠ¥í•œ ê³³ ë³´ê¸°
            </a>
          </li>
        </ul>

        <button id="attendance-btn" class="btn">
          ì¶œì„ ì²´í¬
        </button>
      </div>
    </nav>
    <div class="side-overlay" tabindex="-1"></div>

    <!-- ê²€ìƒ‰ -->
    <div class="search-wrapper">
      <div class="input-holder">
        <input type="text" class="search-input" placeholder="ì°¾ìœ¼ì‹¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        <button class="search-icon search-toggle"><span></span></button>
      </div>
      <span class="close search-toggle"></span>
    </div>

    <div class="month-selector btn-group" style="margin: 110px 0 10px 20px;">
      <button type="button" class="month-btn btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        ì¶œì„ ì²´í¬ í™•ì¸ ì›” ì„ íƒ
      </button>
      <ul class="dropdown-menu month-list">
        <li><a class="dropdown-item" href="#">1ì›”</a></li>
        <li><a class="dropdown-item" href="#">2ì›”</a></li>
        <li><a class="dropdown-item" href="#">3ì›”</a></li>
        <li><a class="dropdown-item" href="#">4ì›”</a></li>
        <li><a class="dropdown-item" href="#">5ì›”</a></li>
        <li><a class="dropdown-item" href="#">6ì›”</a></li>
        <li><a class="dropdown-item" href="#">7ì›”</a></li>
        <li><a class="dropdown-item" href="#">8ì›”</a></li>
        <li><a class="dropdown-item" href="#">9ì›”</a></li>
        <li><a class="dropdown-item" href="#">10ì›”</a></li>
        <li><a class="dropdown-item" href="#">11ì›”</a></li>
        <li><a class="dropdown-item" href="#">12ì›”</a></li>
      </ul>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ ì˜ì—­ -->
    <div id="search-result" style="padding:20px; font-size:18px;"></div>

    <script>
      // ì‚¬ì´ë“œë©”ë‰´ í† ê¸€
      (function(){
        var $menuToggle = $('.menu-toggle');
        var $side = $('.side-menu');
        var $overlay = $('.side-overlay');

        function openMenu(){
          $side.addClass('open').attr('aria-hidden','false');
          $overlay.addClass('show');
        }
        function closeMenu(){
          $side.removeClass('open').attr('aria-hidden','true');
          $overlay.removeClass('show');
        }

        $menuToggle.on('click', openMenu);
        $('.side-menu__close, .side-overlay').on('click', closeMenu);
      })();

      // ê²€ìƒ‰ì°½
      var $searchToggle = $('.search-toggle');

      $searchToggle.on('click', function (e) {
        var $target = $(this);
        var $container = $target.closest('.search-wrapper');
        
        if (!$container.hasClass('active')) {
          $container.addClass('active');
          e.preventDefault();
        } else if ($container.hasClass('active') && $target.closest('.input-holder').length == 0) {
          $container.removeClass('active');
          $container.find('.search-input').val('');
        }
      });

      // ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´
      const monthBtn = document.querySelector('.month-btn');
      const monthItems = document.querySelectorAll('.month-list a');

      monthItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault(); // a íƒœê·¸ ê¸°ë³¸ ë™ì‘ ë§‰ê¸°
          monthBtn.textContent = item.textContent; // ë²„íŠ¼ì— ì„ íƒí•œ ì›” ë°˜ì˜
        });
      });

      // ======================
      // ğŸ” ì¶œì„ ê²€ìƒ‰ ê¸°ëŠ¥
      // ======================
      function getKoreanWeekday(dateStr) {
        const day = new Date(dateStr).getDay();
        return ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "][day];
      }

      // ìš”ì¼ë³„ ê°€ê²©
      function getPrice(weekday) {
        return weekday === "í† " || weekday === "ì¼" ? 8000 : 5000;
      }

      // ê²€ìƒ‰ ì‹¤í–‰
      // ======================
      // ğŸ”¥ Firebaseì—ì„œ ì¶œì„ ë°ì´í„° ê²€ìƒ‰
      // ======================
      async function searchAttendance() {
        const { db, ref, get } = window._fb;

        const searchName = $(".search-input").val().trim();
        const selectedMonthText = $(".month-btn").text(); // "11ì›”"

        if (!searchName) return alert("ê²€ìƒ‰í•  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        if (selectedMonthText.includes("ì„ íƒ")) return alert("ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");

        const selectedMonth = parseInt(selectedMonthText.replace("ì›”", ""));

        // Firebase ì „ì²´ ì¶œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const snap = await get(ref(db, "attendance"));
        const data = snap.val() || {};  // {id: {date, name}}

        let results = []; // {date, weekday, price}

        for (const key in data) {
          const item = data[key];  // {date: "2025-11-26", name: "ì§€ë¯¼"}

          const dateObj = new Date(item.date);
          const month = dateObj.getMonth() + 1;

          if (month !== selectedMonth) continue;
          if (!item.name.includes(searchName)) continue;

          const weekday = getKoreanWeekday(item.date);
          const price = getPrice(weekday);

          results.push({ date: item.date, weekday, price });
        }

        const resultDiv = $("#search-result");
        resultDiv.empty();

        if (results.length === 0) {
          resultDiv.html("<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>");
          return;
        }

        // í‘œ ìƒì„±
        let tableHTML = `
          <table border="1" cellpadding="10" style="border-collapse:collapse; width:300px;">
            <thead>
              <tr style="background:#f3f3f3;">
                <th>ë‚ ì§œ</th>
                <th>ìš”ì¼</th>
                <th>ê¸ˆì•¡</th>
              </tr>
            </thead>
            <tbody>
        `;

        let total = 0;

        results.forEach(item => {
          tableHTML += `
            <tr>
              <td>${item.date}</td>
              <td>${item.weekday}ìš”ì¼</td>
              <td>${item.price.toLocaleString()}ì›</td>
            </tr>
          `;
          total += item.price;
        });

        tableHTML += `
            </tbody>
          </table>
          <div style="margin-top:15px; font-weight:bold; font-size:20px;">
            ì´ <span style="color:#d9534f">${results.length}</span>ë²ˆ ì¶œì„<br>
            í•©ê³„: <span style="color:#0275d8">${total.toLocaleString()}ì›</span>
          </div>
          <a href="./money.html" style="display:block;margin-top:15px;color:#2B6CB0;text-decoration:none;">
            ğŸ’¸ ì¼ì°¸ë¹„/ì›”ì •ì•¡ ì…ê¸ˆí•˜ëŸ¬ ê°€ê¸°
          </a>
        `;

        resultDiv.html(tableHTML);
      }
       
      // ======================
      // ğŸ” ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ê°ì§€
      // ======================

      $(".search-toggle").on("click", function(e) {
        // ê²€ìƒ‰ input ì—´ê³  ë‹«ëŠ” ê¸°ëŠ¥ ìœ ì§€í•˜ë©´ì„œâ€¦
        
        const container = $(this).closest('.search-wrapper');

        // ë‹«íˆëŠ” ìˆœê°„ ê²€ìƒ‰ ì‹¤í–‰
        if (container.hasClass('active')) {
          searchAttendance();
        }
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>