<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë´‰ìš°ë¦¬ ì¶œì²µ</title>

  <link rel="icon" type="image/png" href="./images/Screenshot_20251118_085515_KakaoTalk-Photoroom.png">

  <link rel="stylesheet" href="./styles/index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&family=Oswald:wght@200..700&family=Smooch+Sans:wght@100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&family=Stack+Sans+Notch:wght@200..700&display=swap" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js"></script>
</head>

<body>
    <!-- í—¤ë” -->
    <header>
      <div>
        <!-- <a href="/board-game/index.html"> -->
          <a href="./index.html">
          <img src="./images/Screenshot_20251118_085515_KakaoTalk-Photoroom.png" alt="ë´‰ìš°ë¦¬ ë¡œê³ ">
        </a>
      </div>
    </header>

    <!-- ë©”ë‰´ í† ê¸€ ë²„íŠ¼ -->
    <button class="menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°">ğŸ”</button>

    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <nav class="side-menu" aria-hidden="true">
      <div class="side-menu__header">
        <button class="side-menu__close" aria-label="ë©”ë‰´ ë‹«ê¸°">âŒ</button>
      </div>
      
      <div class="side-menu__body">
        <ul>
          <li>
            <!-- <a href="/board-game/see.html"> -->
              <a href="./see.html">
              ğŸ‘€ ì›”ë³„ë¡œ ì¶œì„ì²´í¬ í•œëˆˆì— ë³´ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/money.html"> -->
              <a href="./money.html">
              ğŸ’¸ ì¼ì°¸ë¹„/ì›”ì •ì•¡ ì…ê¸ˆí•˜ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/place.html"> -->
            <a href="./place.html">
              ğŸ¯ ë´‰ìš°ë¦¬ ì•„ì§€íŠ¸ ìœ„ì¹˜ë³´ê¸°
            </a>
          </li>
          <li>
            <!-- <a href="/board-game/parking.html"> -->
            <a href="./parking.html">
              ğŸš˜ ì£¼ì°¨ ê°€ëŠ¥í•œ ê³³ ë³´ê¸°
            </a>
          </li>
        </ul>

        <button id="attendance-btn" class="btn">
          ì¶œì„ ì²´í¬
        </button>
      </div>
    </nav>
    <div class="side-overlay" tabindex="-1"></div>

    <div id='calendar'></div>

    <script>
      // ì‚¬ì´ë“œë©”ë‰´ í† ê¸€
      (function(){
        var $menuToggle = $('.menu-toggle');
        var $side = $('.side-menu');
        var $overlay = $('.side-overlay');

        function openMenu(){
          $side.addClass('open').attr('aria-hidden','false');
          $overlay.addClass('show');
        }
        function closeMenu(){
          $side.removeClass('open').attr('aria-hidden','true');
          $overlay.removeClass('show');
        }

        $menuToggle.on('click', openMenu);
        $('.side-menu__close, .side-overlay').on('click', closeMenu);
      })();

      document.addEventListener("DOMContentLoaded", function () {

  let calendarEl = document.getElementById("calendar");
  let calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    locale: "ko",
    height: "auto",
    dayHeaderFormat: { weekday: "short" },
    dayCellContent(info) { return { html: `<span>${info.date.getDate()}</span>` }; },
    headerToolbar: { left: "prev,next", center: "title", right: "" },

    dateClick: function(info) {
      const clickedDate = info.dateStr;
      let name = prompt(clickedDate + " ì¶œì„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
      if (!name) return;

      // ========================
      // 1) ì„œë²„ POST ìš”ì²­
      // ========================
      fetch("http://localhost:3000/attendance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ date: clickedDate, name })
      })
      .then(res => res.json())
      .then(data => {
        // ì„œë²„ì—ì„œ ë°›ì€ idë¥¼ ì´ë²¤íŠ¸ ê°ì²´ì— ì €ì¥
        calendar.addEvent({
          title: data.name,
          start: data.date,
          allDay: true,
          id: data.id
        });
        alert("ë“±ë¡ ì™„ë£Œ!");
      })
      .catch(() => alert("ì„œë²„ ì €ì¥ ì‹¤íŒ¨"));
    },

    dayMaxEvents: 3,
    moreLinkText: () => "â• ë”ë³´ê¸°",
    moreLinkClick: "popover",

    eventClick: function(info) {
      const oldName = info.event.title;
      const id = info.event.id;

      const newName = prompt(
        "ì´ë¦„ ìˆ˜ì • ë˜ëŠ” ì‚­ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nìˆ˜ì •í•˜ë ¤ë©´ ìƒˆ ì´ë¦„ ì…ë ¥\nì‚­ì œí•˜ë ¤ë©´ ë¹ˆì¹¸ or ì·¨ì†Œ",
        oldName
      );

      if (newName === null || newName.trim() === "") {
        info.event.remove();

        fetch(`http://localhost:3000/attendance/${id}`, { method: "DELETE" })
          .catch(err => console.error("ì‚­ì œ ì‹¤íŒ¨:", err));
        return;
      }

      info.event.setProp("title", newName);

      fetch(`http://localhost:3000/attendance/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: newName })
      }).catch(err => console.error("ìˆ˜ì • ì‹¤íŒ¨:", err));
    }
  });

  calendar.render();

  // ========================
  // ì„œë²„ì—ì„œ ê¸°ì¡´ ì¶œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  // ========================
  fetch("http://localhost:3000/attendance")
    .then(res => res.json())
    .then(data => {
      data.forEach(item => {
        calendar.addEvent({
          title: item.name,
          start: item.date,
          allDay: true,
          id: item.id
        });
      });
    })
    .catch(err => console.error("ì¶œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨", err));

  // ========================
  // ì¶œì„ ë²„íŠ¼ ì´ë²¤íŠ¸
  // ========================
  $("#attendance-btn").on("click", function () {
    let name = prompt("ì¶œì„ì²´í¬í•  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!");

    let today = new Date().toISOString().split("T")[0];

    fetch("http://localhost:3000/attendance", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ date: today, name })
    })
    .then(res => res.json())
    .then(data => {
      calendar.addEvent({
        title: data.name,
        start: data.date,
        allDay: true,
        id: data.id
      });
      alert("ì¶œì„ ì™„ë£Œ!");
    })
    .catch(() => alert("ì„œë²„ ì €ì¥ ì‹¤íŒ¨"));
  });

      });
    </script>
</body>
</html>